version: "3.7"

services:
  web:
    image: josephgotran/web-service:latest
    container_name: web_service
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.web.loadbalancer.server.port=80"
      - "traefik.http.routers.web.rule=Host(`joseph.works`)"
      - "traefik.http.routers.web.entrypoints=websecure"
      - "traefik.http.routers.web.tls.certresolver=letsencrypt"
    environment:
      - NODE_ENV=production
      # Set this to your API gateway URL (without trailing slash)
      - VITE_API_URL=${VITE_API_URL:-https://joseph.works}
      - VITE_NOTIFICATION_WS_URL=${VITE_NOTIFICATION_WS_URL:-wss://api.joseph.works}
    restart: unless-stopped
    networks:
      - traffic_net

  # Development service (optional - for hot reload)
  dev:
    image: node:20-alpine
    working_dir: /app
    command: npm run dev
    volumes:
      - .:/app
      - /app/node_modules
    ports:
      - "5173:5173"
    environment:
      - NODE_ENV=development
      - VITE_API_URL=http://localhost:8000
    profiles:
      - dev
    networks:
      - traffic_net

networks:
    traffic_net:
        external: true
